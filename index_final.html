<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <!--  Loading D3 and dimple.js -->
    <script src="http://d3js.org/d3.v4.min.js"></script>
    <script src="http://dimplejs.org/dist/dimple.v2.3.0.min.js"></script>

    <style>
      h2 {
        text-align: center;
        font-family: Helvetica;
      }
    </style>

    <script type="text/javascript">

      "use strict";

      // Original draw function to create viz

      function draw(data) {

        var margin = 75,
            width = 1400 - margin,
            height = 600 - margin;

        d3.select("body")
          .append("h2")
          .text("US flight delays: Weather far from the main cause")

        d3.select("body")
          .append("div")
          .style("width", '1250px')
          .style("height", '100px')
          .style("margin", '25px')
          .text("With safety being paramount in aviation, weather (e.g., strong winds, fog, snow, heavy rainfall, etc.) would seem like a top reason for flight delays. Moreover, if weather is a main cause, delays could be expected to follow seasonal patterns. Since 2003, the US Bureau of Transportation Statistics (BTS) has been collecting details on the causes of flights delays in the US. The data show that, in fact, the most common types of delays are Late Aircraft, National Aviation Services (NAS), and Carrier delays. While these types of delays do show seasonal variation – delays tend to peak in summer and winter – most of those delays are not due to challending weather conditions. This is true across the years analyzed here (2004-2008), which can be explored and compared via the dropdown menu.")
          .style("font-size", "18px");

        var svg = d3.select("body")
          .append("svg")
            .attr("width", width + margin)
            .attr("height", height + margin)
          .append('g')
              .attr('class','chart');

        data = dimple.filterData(data, "Year", ["2008"])
        var myChart = new dimple.chart(svg, data);
        myChart.setBounds(60, 30, 1150, 400);
        var x = myChart.addTimeAxis("x", "myMonth", "%Y-%m-%d", "%b");
        x.title = "Month";
        var y = myChart.addMeasureAxis("y", "Delay");
        y.title = "Total delay in minutes";
        myChart.addSeries("DelayType", dimple.plot.line);
        myChart.addSeries("DelayType", dimple.plot.scatter);
        // if (condition) {
        //
        // }
        var lgnd = myChart.addLegend(1250, 250, 150, 800, "right");
        myChart.draw()
        d3.select('#dimple-weatherdelay')
          .style('stroke-width', '1px')
          .transition()
          .duration(1500)
          .style('stroke-width', '12px')
          .transition()
          .duration(750)
          .style('stroke-width', '4px');
      };

      // Updated draw function for 2007

      function draw2007(data) {

        var margin = 75,
            width = 1400 - margin,
            height = 600 - margin;

        var svg = d3.select("body")
          .append("svg")
            .attr("width", width + margin)
            .attr("height", height + margin)
          .append('g')
              .attr('class','chart');

        data = dimple.filterData(data, "Year", ["2007"])
        var myChart = new dimple.chart(svg, data);
        myChart.setBounds(60, 30, 1150, 400);
        var x = myChart.addTimeAxis("x", "myMonth", "%Y-%m-%d", "%b");
        x.title = "Month";
        var y = myChart.addMeasureAxis("y", "Delay");
        y.title = "Total delay in minutes";
        myChart.addSeries("DelayType", dimple.plot.line);
        myChart.addSeries("DelayType", dimple.plot.scatter);
        var lgnd = myChart.addLegend(1250, 250, 150, 800, "right");
        myChart.draw();
        d3.select('#dimple-weatherdelay')
          .style('stroke-width', '4px');
      };


      // Updated draw function for 2006

      function draw2006(data) {

        var margin = 75,
            width = 1400 - margin,
            height = 600 - margin;

        var svg = d3.select("body")
          .append("svg")
            .attr("width", width + margin)
            .attr("height", height + margin)
          .append('g')
              .attr('class','chart');

        data = dimple.filterData(data, "Year", ["2006"])
        var myChart = new dimple.chart(svg, data);
        myChart.setBounds(60, 30, 1150, 400);
        var x = myChart.addTimeAxis("x", "myMonth", "%Y-%m-%d", "%b");
        x.title = "Month";
        var y = myChart.addMeasureAxis("y", "Delay");
        y.title = "Total delay in minutes";
        myChart.addSeries("DelayType", dimple.plot.line);
        myChart.addSeries("DelayType", dimple.plot.scatter);
        var lgnd = myChart.addLegend(1250, 250, 150, 800, "right");
        myChart.draw();
        d3.select('#dimple-weatherdelay')
          .style('stroke-width', '4px');
      };


      // Updated draw function for 2005

      function draw2005(data) {

        var margin = 75,
            width = 1400 - margin,
            height = 600 - margin;

        var svg = d3.select("body")
          .append("svg")
            .attr("width", width + margin)
            .attr("height", height + margin)
          .append('g')
              .attr('class','chart');

        data = dimple.filterData(data, "Year", ["2005"])
        var myChart = new dimple.chart(svg, data);
        myChart.setBounds(60, 30, 1150, 400);
        var x = myChart.addTimeAxis("x", "myMonth", "%Y-%m-%d", "%b");
        x.title = "Month";
        var y = myChart.addMeasureAxis("y", "Delay");
        y.title = "Total delay in minutes";
        myChart.addSeries("DelayType", dimple.plot.line);
        myChart.addSeries("DelayType", dimple.plot.scatter);
        var lgnd = myChart.addLegend(1250, 250, 150, 800, "right");
        myChart.draw();
        d3.select('#dimple-weatherdelay')
          .style('stroke-width', '4px');
      };


      // Updated draw function for 2004

      function draw2004(data) {

        var margin = 75,
            width = 1400 - margin,
            height = 600 - margin;

        var svg = d3.select("body")
          .append("svg")
            .attr("width", width + margin)
            .attr("height", height + margin)
          .append('g')
              .attr('class','chart');

        data = dimple.filterData(data, "Year", ["2004"])
        var myChart = new dimple.chart(svg, data);
        myChart.setBounds(60, 30, 1150, 400);
        var x = myChart.addTimeAxis("x", "myMonth", "%Y-%m-%d", "%b");
        x.title = "Month";
        var y = myChart.addMeasureAxis("y", "Delay");
        y.title = "Total delay in minutes";
        myChart.addSeries("DelayType", dimple.plot.line);
        myChart.addSeries("DelayType", dimple.plot.scatter);
        var lgnd = myChart.addLegend(1250, 250, 150, 800, "right");
        myChart.draw();
        d3.select('#dimple-weatherdelay')
          .style('stroke-width', '4px');
      };


      // Updated draw function to reload 2008

      function draw2008(data) {

        var margin = 75,
            width = 1400 - margin,
            height = 600 - margin;

        var svg = d3.select("body")
          .append("svg")
            .attr("width", width + margin)
            .attr("height", height + margin)
          .append('g')
              .attr('class','chart');

        data = dimple.filterData(data, "Year", ["2008"])
        var myChart = new dimple.chart(svg, data);
        myChart.setBounds(60, 30, 1150, 400);
        var x = myChart.addTimeAxis("x", "myMonth", "%Y-%m-%d", "%b");
        x.title = "Month";
        var y = myChart.addMeasureAxis("y", "Delay");
        y.title = "Total delay in minutes";
        myChart.addSeries("DelayType", dimple.plot.line);
        myChart.addSeries("DelayType", dimple.plot.scatter);
        var lgnd = myChart.addLegend(1250, 250, 150, 800, "right");
        myChart.draw();
        d3.select('#dimple-weatherdelay')
          .style('stroke-width', '4px');
      };

    </script>
  </head>

  <body>

      <script type="text/javascript">
        // Using D3 to load the data;
        // after load is complete, draw function is executed
        d3.csv("data/delays_monthly_2004-2008.csv", draw);
      </script>

      <!--  Creating a select button with options for the years -->

      <select id="year" name="year_selection">
        <option value="2008">2008</option>
        <option value="2007">2007</option>
        <option value="2006">2006</option>
        <option value="2005">2005</option>
        <option value="2004">2004</option>
      </select>

      <!--  Logic to load data based on user input -->

      <script type="text/javascript">
        d3.select("#year").on("change", function() {
          selectValue = d3.select('select').property('value');
          if (selectValue == 2007) {
            d3.select("svg")
              .remove();
            d3.csv("data/delays_monthly_2004-2008.csv", draw2007)
              .transition
              .duration(500);
          }
          if (selectValue == 2006) {
            d3.select("svg").remove();
            d3.csv("data/delays_monthly_2004-2008.csv", draw2006)
              .transition
              .duration(500);
          }
          if (selectValue == 2005) {
            d3.select("svg")
              .remove();
            d3.csv("data/delays_monthly_2004-2008.csv", draw2005)
              .transition
              .duration(500);
          }
          if (selectValue == 2004) {
            d3.select("svg")
              .remove();
            d3.csv("data/delays_monthly_2004-2008.csv", draw2004)
              .transition
              .duration(500);
          }
          if (selectValue == 2008) {
            d3.select("svg")
              .remove();
            d3.csv("data/delays_monthly_2004-2008.csv", draw2008)
              .transition
              .duration(500);
          }
        })
      </script>
</html>
